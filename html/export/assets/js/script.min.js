const yearColumn=document.getElementById("yearColumn"),yearButton=document.getElementById("selectedYear").cloneNode(!0),monthColumn=document.getElementById("monthColumn"),monthButton=document.getElementById("selectedMonth").cloneNode(!0),imageColumn=document.getElementById("imageColumn").cloneNode(!0),img=document.getElementById("img").cloneNode(!0);for(;document.getElementById("imagesRow").firstChild;)document.getElementById("imagesRow").removeChild(document.getElementById("imagesRow").firstChild);const imagesRow=document.getElementById("imagesRow").cloneNode(!0);for(;document.getElementById("imagesColumn").firstChild;)document.getElementById("imagesColumn").removeChild(document.getElementById("imagesColumn").firstChild);const imagesColumn=document.getElementById("imagesColumn"),conf={req:{http:"https",location:"joeypixel.eu/api"}},buttonClick={year:e=>{console.log(`Year clicked: ${e}`)},month:e=>{console.log(`Month clicked: ${e}`)}},makeRequest=e=>new Promise((async o=>{const t=new XMLHttpRequest;t.addEventListener("load",(function(){try{const e=JSON.parse(this.responseText);o(e)}catch(e){console.warn(`Couldn't parse JSON: ${j}`),o(this.responseText)}})),t.open("GET",e),t.send()}));let lastRequest=null;const refreshHeaderBar=(e,o)=>new Promise((async t=>{for(;imagesColumn.firstChild;)imagesColumn.removeChild(imagesColumn.firstChild);for(;yearColumn.firstChild;)yearColumn.removeChild(yearColumn.firstChild);for(;monthColumn.firstChild;)monthColumn.removeChild(monthColumn.firstChild);lastRequest?parseRequest(lastRequest,e,o):makeRequest(`${conf.req.http}://${conf.req.location}${conf.req.port?`:${conf.req.port}`:""}/getYears`).then((t=>{lastRequest=t,parseRequest(lastRequest,e,o)}))})),render=e=>{console.log("render called, with list:",e);const o=[];let t=0;for(file of e){t%4==0&&o.push(imagesRow.cloneNode(!0)),t++;const e=document.createElement("a"),n=img.cloneNode(!0);e.style.cssText=n.style.cssText,n.style.width="100%",n.style["margin-bottom"]="0px",e.href=`${conf.req.http}://${conf.req.location}${conf.req.port?`:${conf.req.port}`:""}/${file.year}/${file.month}/${file.name}`,n.src=`${conf.req.http}://${conf.req.location}${conf.req.port?`:${conf.req.port}`:""}/thumbnail/${file.year}/${file.month}/${file.name}`,e.appendChild(n),console.log(`set src as ${n.src}`),o[o.length-1].appendChild(e)}for(row of(console.log(`appending ${o.length} row(s) for ${e.length} image(s)`),o))imagesColumn.appendChild(row);imagesColumn.appendChild(o[0])},parseRequest=async(e,o,t)=>{const n=Object.entries(e).map((e=>({year:e[0],months:Object.keys(e[1])})));console.log("years",n),e[o]?e[o]&&e[o][t]||(console.log(`Selected year cannot be found! (selected: ${t})`),t=null):(console.log(`Selected year cannot be found! (selected: ${o}, but ${Object.keys(e).join(", ")} is available!)`),o=null,t=null),n.forEach((({year:e,months:l},s)=>{const r=yearButton.cloneNode(!0),c=monthButton.cloneNode(!0);r.innerHTML=`${e}`,r.onclick=()=>refreshHeaderBar(`${e}`);let a=[];!o&&s===n.length-1||o===e?(console.log(`Setting ${e} as selected year, because ${o?`the selected year is set as ${o}!`:`of index ${s} & no selected year!`}`),o=e,console.log(`Adding month buttons: ${l.join(", ")}`),a=l.sort(((e,o)=>(e=Number(e))>(o=Number(o))?-1:e<o?1:0)).map(((e,n)=>{const l=c.cloneNode(!0);return l.innerHTML=e,l.onclick=()=>refreshHeaderBar(o,e),!t&&0===n||t===e?(console.log(`Setting ${e} as selected month, because ${t?`the selected month is set as ${t}!`:`of index ${n} & no selected month!`}`),t=e):l.style.background="rgba(0,0,0,0)",l})).reverse()):r.style.background="rgba(0,0,0,0)",yearColumn.appendChild(r),a.length>0&&a.forEach((e=>monthColumn.appendChild(e)))})),render(e[o][t])},refreshStuff=()=>makeRequest(`${conf.req.http}://${conf.req.location}${conf.req.port?`:${conf.req.port}`:""}${window.location.pathname}`).then((async e=>{console.log(e)}));refreshHeaderBar();